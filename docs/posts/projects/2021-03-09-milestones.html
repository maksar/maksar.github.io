<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Shestakov Alex Blog - Power Automate for low-code services</title>
  <link rel="stylesheet" href="../../css/default.css" />

  <script type="text/javascript" src="../../vendor/jquery/jquery-3.6.0.min.js"></script>
  <script type="text/javascript" src="../../vendor/fresco/js/fresco.min.js"></script>
  <link rel="stylesheet" type="text/css" href="../../vendor/fresco/css/fresco.css" />

  <link rel="stylesheet" href="../../vendor/highlight/styles/atom-one-dark.min.css">
  <script src="../../vendor/highlight/highlight.min.js"></script>
  <script src="../../vendor/highlight/languages/haskell.min.js"></script>
  <script src="../../vendor/highlight/languages/ruby.min.js"></script>
  <script src="../../vendor/highlight/languages/shell.min.js"></script>
  <script src="../../vendor/highlight/languages/kotlin.min.js"></script>
  <script src="../../vendor/highlight/languages/javascript.min.js"></script>
  <script>hljs.highlightAll();</script>
</head>

<body>
  <header>
    <div class="logo">
      <a href="../../">Shestakov Alex</a>
    </div>
    <nav>
      &amp;<a href="../../languages/english.html">english</a> &amp;<a href="../../languages/russian.html">russian</a>
      @<a href="../../categories/code.html">code</a> @<a href="../../categories/projects.html">projects</a>
      <a href="../../about.html">About</a>
    </nav>
  </header>

  <main role="main">
    <h1>Power Automate for low-code services</h1>
    <article>
  <section class="header">
    March  9, 2021  @<a href="../../categories/projects.html">projects</a> #<a href="../../tags/russian.html">russian</a> #<a href="../../tags/Office%20365.html">Office 365</a> #<a href="../../tags/kotlin.html">kotlin</a>
  </section>
  <section>
    <p>Хочу рассказать о Low Code Platform, которой пришлось воспользоваться буквально на днях – Power Automate от Microsoft. Мне, как разработчику ПО, никогда не нравились подобные системы для “программирования мышкой”. Казалось, что с их помощью сложно добиться хоть сколько-нибудь приемлемого результата. Причин несколько:</p>
<ul>
<li>бесишься из-за неудобности и глючности “интефрейса” – хочется бросить и переключиться в любимый текстовый редактор и написать там “пару строчек кода” вместо накликивания условий и выбора элементов из списка</li>
<li>сетуешь на ограничения платформы, из-за невозможности смоделировать простейшие операции: нельзя “обновить” значение переменной используя текущее значение, такая вот борьба с рекурсией</li>
<li>удивляешься тому как тебе придется поддреживать настроенный “бизнес процесс” – буквально смотря на его блок-схему, отвыкли от такого программисты еще со школьных времен.</li>
</ul>
<p>Прорвавшись через начальную пелену отрицания, удалось посмотреть на все с другой стороны – постойте-ка, это же Low Code Platform – она и не предназначена для использования программистами… Все вдруг становится на свои места, если представить себя бизнес-аналитиком или менеджером. Суть алгоритмов отраженных в визуализированном виде – проста и понятна, знаний программирования для моделирования бизнес процессов не требуется, везде подсказки и автодополнение – красота!</p>
<p>Рассмотрим три случая использования – один без кода совсем, два остальных – с небольшим его количеством.</p>
<h2 id="автоматизация-создания-проектных-карт">Автоматизация создания проектных карт</h2>
<p>Решение “без кода” автоматизирует процесс сбора данных для создания новой проектной карты. Для этого в Microsoft Forms создан <a href="https://forms.office.com/Pages/ResponsePage.aspx?id=y5lyFjrnCEylee896o1YNaHtV6z8fXhPi05De-ZazKFUMUNROUU5TUdFWDFUQ0k1VlQzWlE1MTlPOCQlQCN0PWcu">опросник</a>, подобный тому что используется в ежегодном корпоративном опросе. Power Automate реагирует на заполнение формы и запускает первый сценарий, в процессе которого из полей формы формируется <a href="../../images/milestones/12.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">письмо</a>. Power Automate услужливо подсказывает, что есть переменные “Responders’ email” (так как в форме мы указали, что заполнять ее могут тоьлко сотрудники организации), позволяет <a href="../../images/milestones/13.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">накликивать</a> другие поля из формы (причем редактирование полей в форме не ломает сценарий – на самом деле используются GUID-ы). Если сильно хочется – можно и <a href="../../images/milestones/6.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">выраженьице</a> составить несложное – с таким справится человек и без навыков программирования.</p>
<p>Следующий <a href="../../images/milestones/4.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">сценарий</a> реагирует на отосланное письмо и <a href="../../images/milestones/11.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">создает</a> задачи со встречами. Решение не концентрировать все шаги в одном сценарии осознанное - хочется, чтобы бизнес процесс мог начаться не только с заполнения формы, но и с получения письма от живого человека. Людям без навыков программирования обязательно понравятся возможности отладки – на каждом шаге <a href="../../images/milestones/18.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">видно</a> данные на входе и выходе, время работы и даже циклы удобно <a href="../../images/milestones/3.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">пролистывать</a>.</p>
<h2 id="обновление-размеров-проектов">Обновление размеров проектов</h2>
<p>Второе и третье использование Power Automate тоже касается проектных карт.</p>
<p>В ходе работы CTO/PMO Office, мы мониторим состояние проектов. Хочется концентрировать больше внимания на стартующих, ранжируя проекты на основании даты старта и количества трудозатрат. Существует <a href="../../images/milestones/9.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">табличка</a> в Office 365, где мы ведем список дел, строим планы и т.д. В ней отмечено количество трудозатрат по данным проектной карты. Но время-то идет, проекты растут и развиваются, каждый раз сверяться с данными из JIRA – устанет рука. Мы создали Power Automate flow, который может реагировать на получение HTTP запроса извне. Сам endpoint создается автоматически, вам остается задать json schema входящих данных и настроить их использование. На <a href="../../images/milestones/15.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">скриншоте</a> видно, что на входе – список названий проектов с их трудозатратами, которые используются для <a href="../../images/milestones/7.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">обновления</a> строк таблицы. Endpoint есть, дело за малым – настроить еще один flow, запускающийся по <a href="../../images/milestones/17.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">расписанию</a> (можно стартовать и вручную), который <a href="../../images/milestones/1.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">собирает</a> все названия проектов из Excel таблицы и <a href="../../images/milestones/16.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">дергает</a> простенький микросервис на kotlin.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>projectCards<span class="op">(</span>env<span class="op">[</span>TOTAL_EFFORTS_FIELD<span class="op">]).</span>associateBy <span class="op">{</span> it<span class="op">.</span>summary <span class="op">}.</span>let <span class="op">{</span> mapping <span class="op">-&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  HttpClient<span class="op">(</span>ClientCIO<span class="op">)</span> <span class="op">{</span> install<span class="op">(</span>JsonFeature<span class="op">)</span> <span class="op">}</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>post<span class="op">&lt;</span>Any<span class="op">&gt;(</span>env<span class="op">[</span>CALLBACK_URL<span class="op">])</span> <span class="op">{</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    body <span class="op">=</span> call<span class="op">.</span>receive<span class="op">&lt;</span>Array<span class="op">&lt;</span>Summary<span class="op">&gt;&gt;()</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span>sortedBy <span class="op">{</span> it<span class="op">.</span>summary <span class="op">}.</span>mapNotNull <span class="op">{</span> project <span class="op">-&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>        mapping<span class="op">[</span>project<span class="op">.</span>summary<span class="op">]?.</span>getField<span class="op">(</span>env<span class="op">[</span>TOTAL_EFFORTS_FIELD<span class="op">])?.</span>value<span class="op">?.</span>let <span class="op">{</span> efforts <span class="op">-&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>          Effort<span class="op">(</span>project<span class="op">.</span>summary<span class="op">,</span> <span class="op">(</span>efforts <span class="kw">as</span> <span class="kw">Double</span> <span class="op">/</span> <span class="dv">168</span><span class="op">).</span>roundTo<span class="op">(</span><span class="dv">2</span><span class="op">))</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Таким образом, каждый день в Excel файле будут свежие данные о “размере” проекта.</p>
<h2 id="работа-с-качеством-данных-в-проектных-картах">Работа с качеством данных в проектных картах</h2>
<p>В проектных картах сменился формат поля Customer region. Теперь оно с автодополнением, стандартизированного формата. Но всего не предусмотришь, кто-то может и адрес в него вписать. Как же блюсти качество данных, реагировать чтоли на почтовые нотификации об изменении значения этого поля от джиры?.. Решением стал <a href="../../images/milestones/2.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">скрипт</a> автоматизации в Excel 365, который “ходит” за данными, добавляет их в <a href="../../images/milestones/8.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">таблицу</a>, строит <a href="../../images/milestones/14.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">Pivot table</a> и даже добавляет <a href="../../images/milestones/10.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">Pie chart</a>. Даже тут Microsoft делает все возможное для того, чтобы такой автоматизацией могли пользоваться не только программисты – крутой <a href="../../images/milestones/5.jpg" class="fresco" data-fresco-options="ui: 'inside', thumbnails: false">intelli-sense</a>, возможность записи макросов и просмотр получившегося кода, консоль отладки. За данными скрипт ходит в небольшой микросервис на kotlin.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>projectCards<span class="op">(</span>env<span class="op">[</span>CUSTOMER_REGION_FIELD<span class="op">]).</span>let <span class="op">{</span> cards <span class="op">-&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="va">regions</span> <span class="op">=</span> cards<span class="op">.</span>mapNotNull <span class="op">{</span> it<span class="op">.</span>getField<span class="op">(</span>env<span class="op">[</span>CUSTOMER_REGION_FIELD<span class="op">])?.</span>value<span class="op">?.</span>toString<span class="op">()</span> <span class="op">}</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="va">map</span> <span class="op">=</span> regions<span class="op">.</span>groupingBy <span class="op">{</span> it <span class="op">}.</span>eachCount<span class="op">()</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> <span class="va">size</span> <span class="op">=</span> regions<span class="op">.</span>maxOf <span class="op">{</span> it<span class="op">.</span>split<span class="op">(</span><span class="st">&quot;, &quot;</span><span class="op">).</span>size <span class="op">}</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  call<span class="op">.</span>respond<span class="op">(</span>Statistics<span class="op">(</span>size<span class="op">,</span> regions<span class="op">.</span>distinct<span class="op">().</span>map <span class="op">{</span> region <span class="op">-&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      Region<span class="op">(</span>region<span class="op">.</span>split<span class="op">(</span><span class="st">&quot;, &quot;</span><span class="op">).</span>plus<span class="op">(</span>generateSequence <span class="op">{</span> <span class="st">&quot;&quot;</span> <span class="op">}.</span>take<span class="op">(</span><span class="dv">10</span><span class="op">)).</span>take<span class="op">(</span>size<span class="op">),</span> map<span class="op">.</span>getValue<span class="op">(</span>region<span class="op">))</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">}))</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Да, решение “наколеночное”, масшабировать его будет затруднительно. Однако прелесть в том, что для быстрой автоматизации для “проверки идеи” Power BI не нужен, достаточно и такого “наколенника”.</p>
<h2 id="выводы">Выводы</h2>
<p>Смело могу советовать Power Automate как средство для автоматизации мелких процессов как внутри проекта, так и на уровне компании. Vendor-lock максимальный, но мы же не программную систему на нем строим, а только решаем мелкие прикладные задачи. Возможности всей <a href="https://powerplatform.microsoft.com/en-us/">Power Platform</a> сильно шире скриншотов из этой заметки. Вот классная <a href="https://habr.com/ru/post/520926/">статья</a> на эту тему.</p>
  </section>
</article>

  </main>

  <footer>
    <a type="application/rss+xml" href="../../rss.xml">RSS Feed</a>
    Site generated by
    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
  </footer>
</body>

</html>